<html>
    <script src="/latens/config.js"></script>
    <script src="/baremux/index.js"></script>
    <script src="/epoxy/index.js"></script>

    <script>
        async function init() {
            const connection = new BareMux.BareMuxConnection("/baremux/worker.js");
            const wispUrl = "wss://wisp.mercurywork.shop/";
            await connection.setTransport("/epoxy/index.mjs", [{ wisp: wispUrl }]);
        }
        
        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", init);
        } else {
            init();
        }
        navigator.serviceWorker.getRegistrations().then(registrations => {
            if (registrations[0] === undefined) {
                navigator.serviceWorker.register('/latens/sw.js')
            }
        });


    function murder() {
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker
            .getRegistrations()
            .then((registrations) => {
                for (let registration of registrations) {
                registration.unregister();
                }
            })
            .then(() => {window.location.reload()})
        }

    }
    function nav(event) {
        if (event.key == "Enter") {
            event.preventDefault()
            document.body.innerHTML = `<iframe src="${__$latens$config.prefix}${__$latens$config.encodeURL(document.getElementById("inputbox").value)}" height=100% width=100%></iframe>`;
        }
    }

    </script>

    <button onclick="murder()">
        Restart SW (with changes)
    </button>
    <input id="inputbox" onsubmit="nav()" onkeypress="nav(event)"></input>
</html>